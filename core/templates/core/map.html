{% extends 'base.html' %}
{% block content %}
	{# imports maplibre-gl script and stylesheet for map integration #}
	<link href="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.js"></script>	
	<style>
		#map-container { height: 100%; position: relative}
		#map { height: 80%; width: 80%; margin: 0 auto; max-width: 1000px; }
		#start-title {	position: absolute; top: 15%; left: 46.5%; }
		.transition-ease { transition: all 2s ease-out; }
		.hidden { opacity: 0 }
		.cursor-pointer { cursor: pointer; }	  
	</style>
	
	<div id='map-container'>
		<div id='map' class='transition-ease hidden cursor-pointer'></div>
		<span id='start-title' class='transition-ease cursor-pointer'>Click to start</span>
	</div>

	{{ MAPBOX_TOKEN|json_script:"token" }}	
	<script>
		mapdiv = document.getElementById('map')
		const token = JSON.parse(document.getElementById('token').textContent) 

		mapboxgl.accessToken = `${token}`;
		const map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v9',
			projection: 'globe', // Display the map as a globe, since satellite-v9 defaults to Mercator
			zoom: 0.7,
			center: [15, 80],
			attributionControl: false,
			animate: true
		});

		let id
		function rotateCamera(timestamp) {
			// rotate at approximately ~10 degrees per second
			map.rotateTo((timestamp / 150) % 360, { duration: 0, });
			// request the next frame of the animation
			id = requestAnimationFrame(rotateCamera);
		}

		map.on('load', () => {
			mapdiv.classList.remove('hidden')
			// start the animation
			rotateCamera(0);
		})

		// map navigation controls
		// map.addControl(new mapboxgl.NavigationControl());

		map.on('click', () => {
			cancelAnimationFrame(id)
			document.getElementById('start-title').classList.add('hidden')
			map.flyTo({center: [-53, -12], zoom: 3, pitch: 0, duration: 4500, bearing: 0})
			mapdiv.classList.remove('cursor-pointer')
		})
	</script>
{% endblock %}
